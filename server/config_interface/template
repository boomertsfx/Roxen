<!-- -*- html -*- -->
<!-- $Id$ -->

<define tag='cfg-variables'>
  <set variable='form.__redirect' value='1' />
  <if not variable='_.nosave'><cf-save/></if>
  <if variable='form.section'>
    <input type='hidden' name='section' value='&form.section;'/>
    <set variable='var.section' value='&form.section;'/>
  </if>
  <!-- cfg-variables -->
  <set variable='var.oldchanged' value='0'/>
  <div class="cfg-variables">
    <eval><emit ::='&_.args;'>
      <cf-render-variable/>
    </emit></eval>
  </div>
  <if not variable='_.nosave'><cf-save/></if>
</define>

<define container="cf-title">
  <h2 class='no-margin-top'><contents /></h2>
</define>

<define container="st-tabs" scope="st-tabs">
  <define preparse="1" variable="var.__tabs"><contents scope="st-tabs"/></define>
</define>

<define container="st-page" scope="st-page">
  <define preparse="1" variable="var.__contents">
    <contents scope="st-page"/>
  </define>
</define>

<define container="cv-leftside" scope="cv-leftside">
  <define preparse="1" variable="var.leftside"><contents scope="cv-leftside"/>&usr.lefthtml:none;</define>
</define>

<define container="cv-split">
  <cset variable="var.left-content">&var.leftside:none;</cset>
  <div class="flex-row page-contents">
    <if sizeof="var.left-content &gt; 0">
      <div class="left-content flex">&var.left-content:none;</div>
    </if>
    <!-- main content -->
    <div class="right-content flex">
      <contents/>
    </div>
  </div>
</define>

<define container="cv-startpage">
  <!-- cv-startpage -->
  <cv-split>
    <subtablist>
      <st-tabs><insert file="/cv_startpage_tabs.pike"/></st-tabs>
      <st-page><contents/></st-page>
    </subtablist>
   </cv-split>
</define>

<define container="subtablist">
  <nooutput>
    <contents/>
  </nooutput>

  <div class="main-column">
    <if sizeof="var.__tabs > 0">
      <xtablist>
        <eval>&var.__tabs:none;</eval>
      </xtablist>
    </if>
    <div class="contents">&var.__contents:none;</div>
  </div>
</define>


<define container='xtablist'>
  <set variable="_.ec" value="" />
  <if variable="_.topmenu">
    <set variable="_.ec" value="topmenu" />
  </if>
  <ul class='tablist &_.ec;'>
    <set variable="_.tabs"><contents copy-of='a' result-set/></set>
    <!-- No whitespace between li elements please -->
    <emit source='values' variable='_.tabs'
      ><li>&_.value:none;</li></emit>
  </ul>
</define>

<define container='cbox'>
  <div class="cbox">
    <if variable="_.title">
      <h2 class="title">&_.title;</h2>
    </if>
    <div class="content">
      <contents/>
    </div>
  </div>
</define>

<define tag="topmenu">
 <attrib name="base"></attrib>
 <attrib name="selected">home</attrib>
 <define variable="var._top_content" preparse="1"><insert file="/topmenu.pike"/></define>
</define>

<define container="link-gbutton" scope="link-gbutton">
  <if variable="_.type">
    <set variable="_.type" value=" icon &_.type;" />
  </if>
  <!-- link-gbutton -->
  <define variable="var.url" preparse="1"><gbutton-url preparse="">&link-gbutton.contents;</gbutton-url></define>
  <if variable='_.href'>
    <if variable='_.target'>
      <button class="rxn-admin-btn&_.type;" data-href="&_.href;" data-target="&_.target;"><eval>&_.contents;</eval></button>
    </if>
    <else>
      <button class="rxn-admin-btn&_.type;" data-href="&_.href:none;"><eval>&_.contents;</eval></button>
    </else>
  </if>
  <else>
    <button class="rxn-admin-btn&_.type;" disabled=""><eval>&_.contents;</eval></button>
  </else>
</define>

<define tag="resolve-button-type">
  <attrib name='type' />
  <attrib name="icon" />
  <attrib name="name" />
<nooutput>
  <if variable="_.icon is /internal-roxen-up">
    <set variable='_.type' value='up' />
  </if>
  <elseif variable="_.icon is /internal-roxen-down">
    <set variable='_.type' value='down' />
  </elseif>

  <if variable="_.type != ">
    <set variable="_.type" value=" icon &_.type;" />
  </if>

  <if variable="_.type = ">
    <if variable="_.name is *.delete.*">
      <set variable="_.type" value=" icon delete" />
    </if>
    <if variable="_.name is *.new">
      <set variable="_.type" value=" icon add" />
    </if>
  </if>
</nooutput>&_.type;</define>

<define container="disabled-gbutton" scope="disabled-gbutton">
  <set variable="_.type"> <resolve-button-type type='&_.type;' icon='&_.icon-src;' name='&_.name;'/></set>
  <!-- disabled-gbutton -->
  <button class="rxn-admin-btn&_.type;" disabled="">&_.contents;</button>
</define>

<define container="submit-gbutton" scope="submit-gbutton">
  <attrib name="name">ok</attrib>
  <set variable="_.type"> <resolve-button-type type='&_.type;' icon='&_.icon-src;' name='&_.name;'/></set>
  <!-- submit-gbutton -->
  <button class="rxn-admin-btn submit&_.type;" data-submit='' name="&_.contents;">&_.contents;</button>
</define>

<define container="submit-gbutton2" scope="submit-gbutton2">
  <attrib name="onclick"/>
  <set variable="_.type"> <resolve-button-type type='&_.type;' icon='&_.icon-src;' name='&_.name;'/></set>
  <set variable="var.onclick-confirm" value=""/>
  <if variable="_.onclick = ?*">
    <set variable="var.onclick-confirm" value='onclick="&_.onclick;"'/>
  </if>
  <set variable="contents" type="text/xml"><eval>&_.contents:none;</eval></set>
  <!-- submit-gbutton2 -->
  <button class='rxn-admin-btn&_.type;' data-submit='' name='&_.name;' ::="&var.onclick-confirm;">&_.contents;</button>
</define>

<define tag="cf-save">
  <!-- cf-save -->
  <set variable="var._c" type='text/xml'><translate id="bA">Save</translate></set>
  <button class="rxn-admin-btn icon save" value='&var._c;'>&var._c:none;</button>
  <input type='hidden' name='save.x' value='Save'>
</define>
<define tag="cf-ok"><submit-gbutton2 type="ok" name="ok"><translate id="201">OK</translate></submit-gbutton2></define>
<define tag="cf-cancel"><link-gbutton type="cancel" href="&_.href;"><translate id="202">Cancel</translate></link-gbutton></define>
<define tag="cf-no">3#<gbutton href="&_.href;" width="&usr.gbutton-width;" align="center" vspace="4" img-align="middle" font="&usr.gbutton-font;"> <translate id="no">No</translate> </gbutton> </define>
<define tag="cf-refresh"><link-gbutton href="&page.url;" type="refresh"><translate id="520">Refresh</translate></link-gbutton></define>
<define tag="cf-ok-button"><link-gbutton href="&_.href;" type="ok"><translate id="201">OK</translate></link-gbutton></define>

<define tag="cf-next">
  <button data-submit='' name='next' class='icon next right'><translate id="203">Next</translate></button>
</define>

<define container="content"><cset quote="none" variable="var.content"><contents/></cset></define>

<define container="tmpl"><!doctype html>
  <trans-reg project="roxen_config" />
<html><head>
<meta charet='utf-8'>
<title>
  <set variable="var.cf-headline"><cf-headline/></set>
  <if variable="var.cf-headline = ?*">&var.cf-headline; - </if>
  &roxen.product-name;/&roxen.dist-version; <translate id="204">Administration Interface</translate> - <eval>&_.title:none;</eval>
</title>
<link rel="stylesheet" href="/scss/font-awesome.css">
<link rel="stylesheet" href="/scss/style.css">
<if variable="usr.favicon">
  <link rel="shortcut icon" href="&usr.favicon;">
</if>
<else>
  <link rel="shortcut icon" href="/img/R.png?v=17">
</else>
<script src="/js/lib.js"></script>
<script src="/js/config-if.js"></script>
<if exists="/themes/&usr.theme;/stylesheet.css">
  <link rel="stylesheet" type="text/css" href="/themes/&usr.theme;/stylesheet.css">
</if>
</head>
<gauge variable='var.time_spent' resultonly='yes'>
<nooutput>
  <eval><insert file="/themes/&usr.theme;/theme"/></eval>
  <expire-time now="1"/>
<gauge variable='var.time_parse_spent' resultonly='yes'>
  <contents/>
</gauge>
</nooutput>
  <body>
    <header>
      <div class="site-width site-padding  flex-row">
        <div class="flex">
          <eval>&usr.logo-html:none;</eval>
        </div>
        <div class="flex text-left msg-string">
          <h2><cf-headline /></h2>
        </div>
        <div class="flex text-right">
          <set variable="var._utitle"><translate id="206">User</translate></set>
          <button class="rxn-admin-btn icon user" title="&var._utitle;"
             data-href="/change_user.pike?uid=&usr.user-uid;&amp;&usr.set-wiz-id;"
            >&usr.user-name;</button>
        </div>
      </div>
    </header>
    <nav>
      <div class="site-width">
        <eval>&var._top_content;</eval>
      </div>
    </nav>

    <main>
      <if not variable='_.noform'>
        <if variable="form.action == upload_license.pike">
          <set variable="var.form_extra">enctype="multipart/form-data"</set>
        </if>
        <if variable="form.action == patcher.pike">
          <set variable="var.form_extra">enctype="multipart/form-data"</set>
        </if>
        <form method="POST" action="&cf.current-url;&var.form-anchor;" ::="&var.form_extra;">
          <roxen-automatic-charset-variable/>
          <roxen-wizard-id-variable/>
          &var.content:none;
        </form>
      </if>
      <else>&var.content:none;</else>
    </main>
</gauge>
    <footer>
      <div class="site-padding flex-row">
        <div class="flex">
          <ul class="product">
            <li><img src='/img/R.svg' class='R'><b>&roxen.product-name;</b></li>
            <li>version &roxen.dist-version;</li>
            <li>&roxen.dist-os;</li>
          </ul>
        </div>
        <if debug="yes">
          <div class="flex text-right">
          <set variable="var.time-ms" expr="(int)(var.time_spent * 1000)"/>
          Total render time: &var.time-ms; ms |
          <set variable="var.time-ms" expr="(int)(var.time_parse_spent * 1000)"/>
          Content file: &var.time-ms; ms
          </div>
        </if>
      </div>
    </footer>
  </body>
</html>
</define>
